

=== ./configuracion/serializer.py ===
# ./configuracion/serializer.py

from rest_framework import serializers
from .models import Modulo, Menu, EmpresaModulo, EmpresaModuloMenu

class ModuloSerializer(serializers.ModelSerializer):
    class Meta:
        model = Modulo
        fields = '__all__'  # O define una lista de campos específica

class MenuSerializer(serializers.ModelSerializer):
    class Meta:
        model = Menu
        fields = '__all__'

class EmpresaModuloSerializer(serializers.ModelSerializer):
    class Meta:
        model = EmpresaModulo
        fields = '__all__'

class EmpresaModuloMenuSerializer(serializers.ModelSerializer):
    class Meta:
        model = EmpresaModuloMenu
        fields = '__all__'


=== ./configuracion/admin.py ===
from django.contrib import admin

# Register your models here.


=== ./configuracion/urls.py ===
# ./configuracion/urls.py
from django.urls import path, include
from rest_framework.documentation import include_docs_urls
from rest_framework import routers
from .views import (
    ModuloViewSet,
    MenuViewSet,
    EmpresaModuloViewSet,
    EmpresaModuloMenuViewSet
)

router = routers.DefaultRouter()
router.register(r'modulos', ModuloViewSet, basename='modulos')
router.register(r'menus', MenuViewSet, basename='menus')
router.register(r'empresa-modulos', EmpresaModuloViewSet, basename='empresa-modulos')
router.register(r'empresa-modulos-menus', EmpresaModuloMenuViewSet, basename='empresa-modulos-menus')

urlpatterns = [
    path('', include(router.urls)),
    path('docs/', include_docs_urls(title='Configuración API')),
]


=== ./configuracion/__init__.py ===


=== ./configuracion/migrations/__init__.py ===


=== ./configuracion/migrations/0001_initial.py ===
# Generated by Django 5.1.7 on 2025-03-28 13:01

import django.db.models.deletion
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('coreempresas', '0001_initial'),
    ]

    operations = [
        migrations.CreateModel(
            name='Menu',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('url', models.CharField(max_length=50)),
                ('texto', models.CharField(default='', max_length=50)),
                ('etiqueta', models.CharField(blank=True, max_length=50, null=True)),
                ('descripcion', models.CharField(max_length=255)),
                ('nivel_menu', models.IntegerField(default=3)),
                ('orden', models.IntegerField(blank=True, null=True)),
                ('modificable', models.CharField(default='SI', max_length=2)),
                ('separador_up', models.IntegerField(default=0)),
            ],
            options={
                'db_table': '"dm_sistema"."menus"',
            },
        ),
        migrations.CreateModel(
            name='Modulo',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('modulo', models.CharField(max_length=50)),
                ('nombre', models.CharField(max_length=255)),
                ('nombre_menu', models.CharField(blank=True, max_length=100, null=True)),
                ('estado', models.SmallIntegerField(blank=True, null=True)),
                ('icon', models.CharField(blank=True, max_length=255, null=True)),
                ('orden', models.IntegerField(blank=True, null=True)),
            ],
            options={
                'db_table': '"dm_sistema"."modulos"',
            },
        ),
        migrations.CreateModel(
            name='EmpresaModulo',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('estado', models.IntegerField(default=1)),
                ('empresa', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='empresa_modulos', to='coreempresas.empresa')),
                ('modulo', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='empresa_modulos', to='configuracion.modulo')),
            ],
            options={
                'db_table': '"dm_sistema"."empresa_modulos"',
            },
        ),
        migrations.CreateModel(
            name='EmpresaModuloMenu',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('empresa_modulo', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='menus', to='configuracion.empresamodulo')),
                ('menu', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='empresa_modulos_menus', to='configuracion.menu')),
            ],
            options={
                'db_table': '"dm_sistema"."empresa_modulos_menu"',
            },
        ),
        migrations.AddField(
            model_name='menu',
            name='modulo',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='menus', to='configuracion.modulo'),
        ),
    ]


=== ./configuracion/views.py ===
# ./configuracion/views.py

from rest_framework import viewsets
from .models import Modulo, Menu, EmpresaModulo, EmpresaModuloMenu
from .serializer import (
    ModuloSerializer,
    MenuSerializer,
    EmpresaModuloSerializer,
    EmpresaModuloMenuSerializer
)

class ModuloViewSet(viewsets.ModelViewSet):
    queryset = Modulo.objects.all()
    serializer_class = ModuloSerializer

class MenuViewSet(viewsets.ModelViewSet):
    queryset = Menu.objects.all()
    serializer_class = MenuSerializer

class EmpresaModuloViewSet(viewsets.ModelViewSet):
    queryset = EmpresaModulo.objects.all()
    serializer_class = EmpresaModuloSerializer

class EmpresaModuloMenuViewSet(viewsets.ModelViewSet):
    queryset = EmpresaModuloMenu.objects.all()
    serializer_class = EmpresaModuloMenuSerializer


=== ./configuracion/models.py ===
from django.db import models
# <<-- Corrección: Importar la clase Empresa de la app coreempresas
from coreempresas.models import Empresa

# Create your models here.
class Modulo(models.Model):
    modulo = models.CharField(max_length=50)
    nombre = models.CharField(max_length=255)
    nombre_menu = models.CharField(max_length=100, null=True, blank=True)
    estado = models.SmallIntegerField(null=True, blank=True)
    icon = models.CharField(max_length=255, null=True, blank=True)
    orden = models.IntegerField(null=True, blank=True)

    class Meta:
        db_table = '"dm_sistema"."modulos"'

    def __str__(self):
        return self.nombre

class Menu(models.Model):
    url = models.CharField(max_length=50)
    texto = models.CharField(max_length=50, default='')
    etiqueta = models.CharField(max_length=50, null=True, blank=True)
    descripcion = models.CharField(max_length=255)
    nivel_menu = models.IntegerField(default=3)
    orden = models.IntegerField(null=True, blank=True)
    modificable = models.CharField(max_length=2, default='SI')
    modulo = models.ForeignKey(Modulo, on_delete=models.CASCADE, null=True, blank=True, related_name='menus')
    separador_up = models.IntegerField(default=0)

    class Meta:
        db_table = '"dm_sistema"."menus"'

    def __str__(self):
        return self.descripcion

class EmpresaModulo(models.Model):
    # Ahora Empresa está definido porque lo importamos de coreempresas.models
    empresa = models.ForeignKey(Empresa, on_delete=models.CASCADE, related_name='empresa_modulos')
    modulo = models.ForeignKey(Modulo, on_delete=models.CASCADE, related_name='empresa_modulos')
    estado = models.IntegerField(default=1)

    class Meta:
        db_table = '"dm_sistema"."empresa_modulos"'

    def __str__(self):
        return f'{self.empresa} - {self.modulo}'

class EmpresaModuloMenu(models.Model):
    empresa_modulo = models.ForeignKey(EmpresaModulo, on_delete=models.CASCADE, related_name='menus')
    menu = models.ForeignKey(Menu, on_delete=models.CASCADE, related_name='empresa_modulos_menus')

    class Meta:
        db_table = '"dm_sistema"."empresa_modulos_menu"'

    def __str__(self):
        return f'{self.empresa_modulo} - {self.menu}'


=== ./configuracion/tests.py ===
from django.test import TestCase

# Create your tests here.


=== ./configuracion/apps.py ===
from django.apps import AppConfig


class ConfiguracionConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'configuracion'


=== ./manage.py ===
#!/usr/bin/env python
"""Django's command-line utility for administrative tasks."""
import os
import sys


def main():
    """Run administrative tasks."""
    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'proyectoDesarrollo.settings')
    try:
        from django.core.management import execute_from_command_line
    except ImportError as exc:
        raise ImportError(
            "Couldn't import Django. Are you sure it's installed and "
            "available on your PYTHONPATH environment variable? Did you "
            "forget to activate a virtual environment?"
        ) from exc
    execute_from_command_line(sys.argv)


if __name__ == '__main__':
    main()


=== ./coreempresas/serializer.py ===
# ./coreempresas/serializer.py

from rest_framework import serializers
from .models import Empresa

class EmpresaSerializer(serializers.ModelSerializer):
    class Meta:
        model = Empresa
        fields = '__all__'


=== ./coreempresas/admin.py ===
from django.contrib import admin

# Register your models here.


=== ./coreempresas/urls.py ===
from rest_framework import routers
from django.urls import path, include
from .views import EmpresaViewSet

router = routers.DefaultRouter()
router.register(r'empresa', EmpresaViewSet, basename='empresa')

urlpatterns = [
    path('', include(router.urls)),
]


=== ./coreempresas/__init__.py ===


=== ./coreempresas/migrations/__init__.py ===


=== ./coreempresas/migrations/0001_initial.py ===
# Generated by Django 5.1.7 on 2025-03-28 12:50

import django.core.validators
import django.db.models.deletion
import django.utils.timezone
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='Empresa',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('razon_social', models.CharField(blank=True, max_length=100, null=True)),
                ('direccion', models.CharField(blank=True, max_length=200, null=True)),
                ('comuna', models.CharField(blank=True, max_length=50, null=True)),
                ('ciudad', models.CharField(blank=True, max_length=50, null=True)),
                ('rut', models.CharField(blank=True, max_length=20, null=True)),
                ('giro', models.CharField(blank=True, max_length=255, null=True)),
                ('acteco', models.CharField(blank=True, max_length=10, null=True)),
                ('rut_firma', models.CharField(blank=True, max_length=20, null=True)),
                ('logo', models.CharField(blank=True, max_length=50, null=True)),
                ('subdominio', models.CharField(blank=True, max_length=50, null=True)),
                ('titulo', models.CharField(blank=True, max_length=50, null=True)),
                ('estado', models.IntegerField(default=1)),
                ('fecha_incorporacion', models.DateTimeField(default=django.utils.timezone.now)),
                ('master', models.BooleanField(default=False)),
                ('fecha_modificacion', models.DateTimeField(blank=True, null=True)),
                ('licencias', models.IntegerField(default=5)),
                ('logo_grande', models.CharField(blank=True, max_length=255, null=True)),
                ('ingreso_pcd', models.IntegerField()),
                ('ingreso_funnel', models.IntegerField(default=0)),
                ('mercado', models.CharField(blank=True, max_length=50, null=True)),
            ],
            options={
                'db_table': '"dm_sistema"."empresa"',
                'indexes': [models.Index(fields=['mercado'], name='idx_empresa_mercado'), models.Index(fields=['estado'], name='idx_empresa_estado')],
            },
        ),
        migrations.CreateModel(
            name='EmpresaResolucion',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('numero', models.CharField(max_length=50)),
                ('fecha', models.DateField()),
                ('tipo', models.CharField(default='SII', max_length=20)),
                ('descripcion', models.TextField(blank=True, null=True)),
                ('empresa', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='resoluciones', to='coreempresas.empresa')),
            ],
            options={
                'db_table': '"dm_sistema"."empresa_resolucion"',
            },
        ),
        migrations.CreateModel(
            name='EmpresaTelefono',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('numero', models.CharField(max_length=20)),
                ('tipo', models.CharField(choices=[('FIJO', 'Fijo'), ('MOVIL', 'Móvil'), ('FAX', 'Fax'), ('OTRO', 'Otro')], max_length=10, validators=[django.core.validators.RegexValidator(regex='^(FIJO|MOVIL|FAX|OTRO)$')])),
                ('principal', models.BooleanField(default=False)),
                ('empresa', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='telefonos', to='coreempresas.empresa')),
            ],
            options={
                'db_table': '"dm_sistema"."empresa_telefono"',
            },
        ),
        migrations.CreateModel(
            name='Grupo',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('nombre', models.CharField(blank=True, max_length=255, null=True)),
                ('asignable', models.IntegerField(default=1)),
                ('empresa', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='grupos', to='coreempresas.empresa')),
            ],
            options={
                'db_table': '"dm_sistema"."grupo"',
            },
        ),
        migrations.CreateModel(
            name='EmpresaParam',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('campo', models.CharField(blank=True, max_length=255, null=True)),
                ('valor', models.CharField(blank=True, max_length=255, null=True)),
                ('empresa', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='parametros', to='coreempresas.empresa')),
            ],
            options={
                'db_table': '"dm_sistema"."empresa_param"',
                'indexes': [models.Index(fields=['empresa'], name='idx_empresa_param_empresa_id'), models.Index(fields=['campo'], name='idx_empresa_param_campo')],
            },
        ),
    ]


=== ./coreempresas/views.py ===
from rest_framework import viewsets, status
from rest_framework.decorators import action
from rest_framework.response import Response
from .models import Empresa
from .serializer import EmpresaSerializer
from django.shortcuts import render

# ViewSet para el modelo Empresa que permite listar, crear, actualizar, eliminar
# y obtener datos a partir del id enviado en un POST.
class EmpresaViewSet(viewsets.ModelViewSet):
    queryset = Empresa.objects.all()
    serializer_class = EmpresaSerializer

    @action(detail=False, methods=['post'])
    def obtener_datos(self, request):
        """
        POST /empresa/obtener_datos/
        Recibe en el JSON el campo "id" y retorna los datos de la empresa correspondiente.
        Ejemplo de JSON en el Body:
        {
            "id": 3
        }
        """
        empresa_id = request.data.get("id")
        if not empresa_id:
            return Response(
                {"error": "Falta el campo 'id' en la solicitud."},
                status=status.HTTP_400_BAD_REQUEST
            )
        try:
            empresa = Empresa.objects.get(id=empresa_id)
        except Empresa.DoesNotExist:
            return Response(
                {"error": "No se encontró la empresa con el id proporcionado."},
                status=status.HTTP_404_NOT_FOUND
            )
        serializer = self.get_serializer(empresa)
        return Response(serializer.data, status=status.HTTP_200_OK)

    @action(detail=False, methods=['post'])
    def cambiar_estado(self, request):
        """
        POST /empresa/cambiar_estado/
        Recibe en el JSON los campos "id" y "estado". Actualiza la columna "estado" de la 
        empresa correspondiente al "id" enviado y retorna la empresa actualizada.
        Ejemplo de JSON en el Body:
        {
            "id": 3,
            "estado": 0
        }
        """
        empresa_id = request.data.get("id")
        nuevo_estado = request.data.get("estado")
        if not empresa_id or nuevo_estado is None:
            return Response(
                {"error": "Se requieren los campos 'id' y 'estado' en la solicitud."},
                status=status.HTTP_400_BAD_REQUEST
            )
        try:
            empresa = Empresa.objects.get(id=empresa_id)
        except Empresa.DoesNotExist:
            return Response(
                {"error": "No se encontró la empresa con el id proporcionado."},
                status=status.HTTP_404_NOT_FOUND
            )
        empresa.estado = nuevo_estado
        empresa.save()
        serializer = self.get_serializer(empresa)
        return Response(serializer.data, status=status.HTTP_200_OK)


=== ./coreempresas/models.py ===
from django.db import models
from django.utils import timezone
from django.core.validators import RegexValidator

# Definir primero el arreglo de choices:
TIPO_TELEFONO_CHOICES = [
    ('FIJO', 'Fijo'),
    ('MOVIL', 'Móvil'),
    ('FAX', 'Fax'),
    ('OTRO', 'Otro'),
]

class Empresa(models.Model):
    razon_social = models.CharField(max_length=100, null=True, blank=True)
    direccion = models.CharField(max_length=200, null=True, blank=True)
    comuna = models.CharField(max_length=50, null=True, blank=True)
    ciudad = models.CharField(max_length=50, null=True, blank=True)
    rut = models.CharField(max_length=20, null=True, blank=True)
    giro = models.CharField(max_length=255, null=True, blank=True)
    acteco = models.CharField(max_length=10, null=True, blank=True)
    rut_firma = models.CharField(max_length=20, null=True, blank=True)
    logo = models.CharField(max_length=50, null=True, blank=True)
    subdominio = models.CharField(max_length=50, null=True, blank=True)
    titulo = models.CharField(max_length=50, null=True, blank=True)
    estado = models.IntegerField(default=1)
    fecha_incorporacion = models.DateTimeField(default=timezone.now)
    master = models.BooleanField(default=False)
    fecha_modificacion = models.DateTimeField(null=True, blank=True)
    licencias = models.IntegerField(default=5)
    logo_grande = models.CharField(max_length=255, null=True, blank=True)
    ingreso_pcd = models.IntegerField()
    ingreso_funnel = models.IntegerField(default=0)
    mercado = models.CharField(max_length=50, null=True, blank=True)

    class Meta:
        db_table = '"dm_sistema"."empresa"'
        indexes = [
            models.Index(fields=['mercado'], name='idx_empresa_mercado'),
            models.Index(fields=['estado'], name='idx_empresa_estado'),
        ]

    def __str__(self):
        return self.razon_social or ''


class EmpresaTelefono(models.Model):
    empresa = models.ForeignKey(Empresa, on_delete=models.CASCADE, related_name='telefonos')
    numero = models.CharField(max_length=20)
    tipo = models.CharField(
        max_length=10,
        choices=TIPO_TELEFONO_CHOICES,  # Ahora sí existe
        validators=[RegexValidator(regex=r'^(FIJO|MOVIL|FAX|OTRO)$')],
    )
    principal = models.BooleanField(default=False)

    class Meta:
        db_table = '"dm_sistema"."empresa_telefono"'

    def __str__(self):
        return f'{self.empresa} - {self.numero}'


class EmpresaResolucion(models.Model):
    empresa = models.ForeignKey(Empresa, on_delete=models.CASCADE, related_name='resoluciones')
    numero = models.CharField(max_length=50)
    fecha = models.DateField()
    tipo = models.CharField(max_length=20, default='SII')
    descripcion = models.TextField(null=True, blank=True)

    class Meta:
        db_table = '"dm_sistema"."empresa_resolucion"'

    def __str__(self):
        return f'{self.empresa} - {self.numero}'


class EmpresaParam(models.Model):
    empresa = models.ForeignKey(Empresa, on_delete=models.CASCADE, related_name='parametros')
    campo = models.CharField(max_length=255, null=True, blank=True)
    valor = models.CharField(max_length=255, null=True, blank=True)

    class Meta:
        db_table = '"dm_sistema"."empresa_param"'
        indexes = [
            models.Index(fields=['empresa'], name='idx_empresa_param_empresa_id'),
            models.Index(fields=['campo'], name='idx_empresa_param_campo'),
        ]

    def __str__(self):
        return f'{self.empresa} - {self.campo}'


class Grupo(models.Model):
    nombre = models.CharField(max_length=255, null=True, blank=True)
    asignable = models.IntegerField(default=1)
    empresa = models.ForeignKey(Empresa, on_delete=models.CASCADE, null=True, blank=True, related_name='grupos')

    class Meta:
        db_table = '"dm_sistema"."grupo"'

    def __str__(self):
        return self.nombre or ''


=== ./coreempresas/tests.py ===
from django.test import TestCase

# Create your tests here.


=== ./coreempresas/apps.py ===
from django.apps import AppConfig


class CoreempresasConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'coreempresas'


=== ./gunicorn_start.sh ===
#!/bin/bash
# Nombre del proyecto
NAME="proyectoDesarrollo"
# Directorio del proyecto (ajusta la ruta a tu proyecto)
DJANGODIR="/home/ignrv/proyectos/Gunicorn/proyectoDesarrollo"
# Directorio del entorno virtual (ajusta la ruta a tu venv)
VENV="/home/ignrv/proyectos/Gunicorn/venv/bin/activate"
# Número de workers (ajusta según tus necesidades)
NUM_WORKERS=3
# Módulo WSGI de Django
DJANGO_WSGI_MODULE="proyectoDesarrollo.wsgi:application"

echo "Iniciando Gunicorn para $NAME como $(whoami)"

# Entrar al directorio del proyecto
cd $DJANGODIR || exit
# Activar el entorno virtual
source $VENV

# Exportar la variable de entorno de configuración (si no está ya definida)
export DJANGO_SETTINGS_MODULE=proyectoDesarrollo.settings

# Iniciar Gunicorn
exec gunicorn $DJANGO_WSGI_MODULE \
  --name $NAME \
  --workers $NUM_WORKERS \
  --bind 0.0.0.0:8000 \
  --log-level=info \
  --log-file=-


=== ./logs/admin.py ===
from django.contrib import admin

# Register your models here.


=== ./logs/__init__.py ===


=== ./logs/migrations/__init__.py ===


=== ./logs/migrations/0001_initial.py ===
# Generated by Django 5.1.7 on 2025-03-28 13:25

import django.db.models.deletion
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('coreempresas', '0001_initial'),
        ('operadores', '0001_initial'),
    ]

    operations = [
        migrations.CreateModel(
            name='Log',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('operacion', models.CharField(max_length=30)),
                ('detalle', models.TextField()),
                ('script', models.CharField(max_length=100)),
                ('tabla', models.CharField(max_length=100)),
                ('fecha', models.DateTimeField()),
                ('cliente_id', models.IntegerField(default=0)),
                ('contrato_id', models.IntegerField(default=0)),
                ('suscriptor_id', models.IntegerField(default=0)),
                ('empresa', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='coreempresas.empresa')),
                ('operador', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='logs', to='operadores.operador')),
            ],
            options={
                'db_table': '"dm_sistema"."log"',
                'indexes': [models.Index(fields=['cliente_id'], name='idx_log_cliente_id'), models.Index(fields=['contrato_id'], name='idx_log_contrato_id'), models.Index(fields=['empresa'], name='idx_log_empresa_id')],
            },
        ),
    ]


=== ./logs/views.py ===
from django.shortcuts import render

# Create your views here.


=== ./logs/models.py ===
from django.db import models
# Importa Operador (y Empresa si usas este FK)
from operadores.models import Operador
from coreempresas.models import Empresa  # Si también usas Empresa en logs

class Log(models.Model):
    operador = models.ForeignKey(Operador, on_delete=models.CASCADE, related_name='logs')
    empresa = models.ForeignKey(Empresa, on_delete=models.CASCADE, null=True, blank=True)
    operacion = models.CharField(max_length=30)
    detalle = models.TextField()
    script = models.CharField(max_length=100)
    tabla = models.CharField(max_length=100)
    fecha = models.DateTimeField()
    cliente_id = models.IntegerField(default=0)
    contrato_id = models.IntegerField(default=0)
    suscriptor_id = models.IntegerField(default=0)

    class Meta:
        db_table = '"dm_sistema"."log"'
        indexes = [
            models.Index(fields=['cliente_id'], name='idx_log_cliente_id'),
            models.Index(fields=['contrato_id'], name='idx_log_contrato_id'),
            models.Index(fields=['empresa'], name='idx_log_empresa_id'),
        ]

    def __str__(self):
        return f'Log {self.id} - {self.operacion}'


=== ./logs/tests.py ===
from django.test import TestCase

# Create your tests here.


=== ./logs/apps.py ===
from django.apps import AppConfig


class LogsConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'logs'


=== ./tasks/serializer.py ===
from rest_framework import serializers
from .models import Task

class TaskSerializer(serializers.ModelSerializer):
    class Meta:
        model = Task
        #fields = ['id', 'title', 'description', 'completed']
        fields = '__all__'


=== ./tasks/admin.py ===
from django.contrib import admin
from .models import Task
# Register your models here.
admin.site.register(Task)
 

=== ./tasks/urls.py ===
from django.urls import path, include
from rest_framework.documentation import include_docs_urls
from rest_framework import routers
from tasks import views

# api versioning
router = routers.DefaultRouter()
router.register(r'tasks', views.TaskView, 'tasks')

urlpatterns = [
    path('api/v1/', include(router.urls)),
    path('docs/', include_docs_urls(title='Tasks API')),
]


=== ./tasks/__init__.py ===


=== ./tasks/migrations/__init__.py ===


=== ./tasks/migrations/0001_initial.py ===
# Generated by Django 5.1.7 on 2025-03-21 15:16

from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='Task',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=200)),
                ('description', models.TextField(blank=True)),
                ('completed', models.BooleanField(default=False)),
            ],
        ),
    ]


=== ./tasks/views.py ===
from rest_framework import viewsets
from .serializer import TaskSerializer
from .models import Task

class TaskView(viewsets.ModelViewSet):
    serializer_class = TaskSerializer
    queryset = Task.objects.all()


=== ./tasks/models.py ===
from django.db import models

class Task(models.Model):
    title = models.CharField(max_length=200)
    description = models.TextField(blank=True)
    completed = models.BooleanField(default=False)

    def __str__(self):
        return self.title

=== ./tasks/tests.py ===
from django.test import TestCase

# Create your tests here.


=== ./tasks/apps.py ===
from django.apps import AppConfig


class TasksConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'tasks'


=== ./combined.tx ===


=== ./operadores/serializer.py ===
# ./operadores/serializer.py

from rest_framework import serializers
from .models import (
    Operador, OperadorBodega, OperadorEmpresaModulo, 
    OperadorEmpresaModuloMenu, OperadorGrupo, OperadorPuntoVenta,
    Sesion, SesionActiva
    # SesionEjecutivo ya NO existe
)

class OperadorSerializer(serializers.ModelSerializer):
    class Meta:
        model = Operador
        fields = '__all__'  # O especifica los campos que quieras

class OperadorBodegaSerializer(serializers.ModelSerializer):
    class Meta:
        model = OperadorBodega
        fields = '__all__'

class OperadorEmpresaModuloSerializer(serializers.ModelSerializer):
    class Meta:
        model = OperadorEmpresaModulo
        fields = '__all__'

class OperadorEmpresaModuloMenuSerializer(serializers.ModelSerializer):
    class Meta:
        model = OperadorEmpresaModuloMenu
        fields = '__all__'

class OperadorGrupoSerializer(serializers.ModelSerializer):
    class Meta:
        model = OperadorGrupo
        fields = '__all__'

class OperadorPuntoVentaSerializer(serializers.ModelSerializer):
    class Meta:
        model = OperadorPuntoVenta
        fields = '__all__'

class SesionSerializer(serializers.ModelSerializer):
    class Meta:
        model = Sesion
        fields = '__all__'

class SesionActivaSerializer(serializers.ModelSerializer):
    class Meta:
        model = SesionActiva
        fields = '__all__'

# Se elimina la clase SesionEjecutivoSerializer, ya que no existe el modelo


=== ./operadores/admin.py ===
from django.contrib import admin

# Register your models here.


=== ./operadores/urls.py ===
# ./operadores/urls.py

from django.urls import path, include
from rest_framework import routers
from rest_framework.documentation import include_docs_urls

from .views import (
    OperadorViewSet, OperadorBodegaViewSet, OperadorEmpresaModuloViewSet,
    OperadorEmpresaModuloMenuViewSet, OperadorGrupoViewSet, OperadorPuntoVentaViewSet,
    SesionViewSet, SesionActivaViewSet,
    # Eliminado: SesionEjecutivoViewSet
    OperadorByTokenViewSet
)

router = routers.DefaultRouter()
router.register(r'operadores', OperadorViewSet, basename='operadores')
router.register(r'operadores-bodegas', OperadorBodegaViewSet, basename='operadores-bodegas')
router.register(r'operadores-empresa-modulos', OperadorEmpresaModuloViewSet, basename='operadores-empresa-modulos')
router.register(r'operadores-empresa-modulos-menus', OperadorEmpresaModuloMenuViewSet, basename='operadores-empresa-modulos-menus')
router.register(r'operadores-grupos', OperadorGrupoViewSet, basename='operadores-grupos')
router.register(r'operadores-punto-venta', OperadorPuntoVentaViewSet, basename='operadores-punto-venta')
router.register(r'sesiones', SesionViewSet, basename='sesiones')
router.register(r'sesiones-activas', SesionActivaViewSet, basename='sesiones-activas')
# Se elimina la línea:
# router.register(r'sesiones-ejecutivos', SesionEjecutivoViewSet, basename='sesiones-ejecutivos')

urlpatterns = [
    path('', include(router.urls)),
    path('docs/', include_docs_urls(title='Operadores API')),

    path(
        'sesiones-activas-token/',
        OperadorByTokenViewSet.as_view({'get': 'get_by_cookie'}),
        name='sesiones-activas-token-cookie'
    ),
    path(
        'logout/',
        OperadorViewSet.as_view({'get': 'logout'}),
        name='logout'
    ),
]


=== ./operadores/__init__.py ===


=== ./operadores/migrations/__init__.py ===


=== ./operadores/migrations/0001_initial.py ===
# Generated by Django 5.1.7 on 2025-03-28 13:21

import django.db.models.deletion
import django.utils.timezone
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('configuracion', '0001_initial'),
        ('coreempresas', '0001_initial'),
    ]

    operations = [
        migrations.CreateModel(
            name='Operador',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('operador_id', models.CharField(max_length=50)),
                ('password', models.CharField(default='', max_length=80)),
                ('clear', models.CharField(blank=True, max_length=80, null=True)),
                ('rut', models.CharField(blank=True, max_length=15, null=True)),
                ('nombres', models.CharField(blank=True, max_length=100, null=True)),
                ('apellido_paterno', models.CharField(blank=True, max_length=100, null=True)),
                ('apellido_materno', models.CharField(blank=True, max_length=100, null=True)),
                ('modificable', models.IntegerField(default=1)),
                ('email', models.CharField(blank=True, max_length=50, null=True)),
                ('estado', models.IntegerField(default=1)),
                ('acceso_web', models.IntegerField(default=0)),
                ('conexion_fallida', models.IntegerField(default=0)),
                ('operador_administrador', models.CharField(default='0', max_length=50)),
                ('superadmin', models.IntegerField(default=0)),
                ('fecha_creacion', models.DateTimeField(default=django.utils.timezone.now)),
                ('empresa', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='operadores', to='coreempresas.empresa')),
                ('grupo', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='operadores', to='coreempresas.grupo')),
            ],
            options={
                'db_table': '"dm_sistema"."operador"',
            },
        ),
        migrations.CreateModel(
            name='OperadorBodega',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('bodega_id', models.IntegerField()),
                ('empresa', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='operador_bodegas', to='coreempresas.empresa')),
                ('operador', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='bodegas', to='operadores.operador')),
            ],
            options={
                'db_table': '"dm_sistema"."operador_bodega"',
            },
        ),
        migrations.CreateModel(
            name='OperadorEmpresaModulo',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('empresa_modulo', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='configuracion.empresamodulo')),
                ('operador', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='empresa_modulos', to='operadores.operador')),
            ],
            options={
                'db_table': '"dm_sistema"."operador_empresa_modulos"',
            },
        ),
        migrations.CreateModel(
            name='OperadorEmpresaModuloMenu',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('empresa_modulo_menu', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='configuracion.empresamodulomenu')),
                ('operador', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='empresa_modulos_menus', to='operadores.operador')),
            ],
            options={
                'db_table': '"dm_sistema"."operador_empresa_modulos_menu"',
            },
        ),
        migrations.CreateModel(
            name='OperadorGrupo',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('grupo', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='operadores_grupo', to='coreempresas.grupo')),
                ('operador', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='grupos_operador', to='operadores.operador')),
            ],
            options={
                'db_table': '"dm_sistema"."operador_grupos"',
            },
        ),
        migrations.CreateModel(
            name='OperadorPuntoVenta',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('punto_venta_id', models.IntegerField()),
                ('empresa', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='operador_punto_ventas', to='coreempresas.empresa')),
                ('operador', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='puntos_venta', to='operadores.operador')),
            ],
            options={
                'db_table': '"dm_sistema"."operador_punto_venta"',
            },
        ),
        migrations.CreateModel(
            name='Sesion',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('ip', models.CharField(max_length=20)),
                ('fecha', models.DateTimeField()),
                ('operador_id', models.CharField(max_length=50)),
                ('empresa', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='coreempresas.empresa')),
            ],
            options={
                'db_table': '"dm_sistema"."sesiones"',
            },
        ),
        migrations.CreateModel(
            name='SesionActiva',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('operador_id', models.CharField(blank=True, max_length=50, null=True)),
                ('sesion_id', models.CharField(blank=True, max_length=255, null=True)),
                ('fecha_registro', models.DateTimeField(default=django.utils.timezone.now)),
                ('empresa', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='coreempresas.empresa')),
            ],
            options={
                'db_table': '"dm_sistema"."sesiones_activas"',
            },
        ),
        migrations.CreateModel(
            name='SesionEjecutivo',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('fecha', models.DateTimeField()),
                ('id_ejecutivo', models.IntegerField()),
                ('rut_ejecutivo', models.CharField(blank=True, max_length=50, null=True)),
                ('id_operador', models.CharField(blank=True, max_length=50, null=True)),
                ('portal', models.CharField(blank=True, max_length=255, null=True)),
                ('ip', models.CharField(blank=True, max_length=50, null=True)),
                ('id_empresa', models.ForeignKey(blank=True, db_column='id_empresa', null=True, on_delete=django.db.models.deletion.CASCADE, to='coreempresas.empresa')),
            ],
            options={
                'db_table': '"dm_sistema"."sesiones_ejecutivos"',
            },
        ),
        migrations.AddIndex(
            model_name='operador',
            index=models.Index(fields=['empresa'], name='idx_opr_emp_id'),
        ),
        migrations.AddIndex(
            model_name='operador',
            index=models.Index(fields=['grupo'], name='idx_opr_grp_id'),
        ),
        migrations.AlterUniqueTogether(
            name='operador',
            unique_together={('operador_id', 'empresa')},
        ),
        migrations.AddIndex(
            model_name='operadorbodega',
            index=models.Index(fields=['bodega_id'], name='idx_opbdg_bdg_id'),
        ),
        migrations.AddIndex(
            model_name='operadorbodega',
            index=models.Index(fields=['empresa'], name='idx_opbdg_emp_id'),
        ),
        migrations.AddIndex(
            model_name='operadorempresamodulo',
            index=models.Index(fields=['operador'], name='idx_oem_opr_id'),
        ),
        migrations.AddIndex(
            model_name='operadorempresamodulo',
            index=models.Index(fields=['empresa_modulo'], name='idx_oem_em_id'),
        ),
        migrations.AddIndex(
            model_name='operadorempresamodulomenu',
            index=models.Index(fields=['operador'], name='idx_oemm_opr_id'),
        ),
        migrations.AddIndex(
            model_name='operadorempresamodulomenu',
            index=models.Index(fields=['empresa_modulo_menu'], name='idx_oemm_mm_id'),
        ),
        migrations.AlterUniqueTogether(
            name='operadorgrupo',
            unique_together={('operador', 'grupo')},
        ),
        migrations.AddIndex(
            model_name='operadorpuntoventa',
            index=models.Index(fields=['empresa'], name='idx_opv_emp_id'),
        ),
        migrations.AddIndex(
            model_name='sesionactiva',
            index=models.Index(fields=['sesion_id'], name='idx_sact_sid'),
        ),
        migrations.AddIndex(
            model_name='sesionactiva',
            index=models.Index(fields=['empresa'], name='idx_sact_emp_id'),
        ),
        migrations.AddIndex(
            model_name='sesionejecutivo',
            index=models.Index(fields=['fecha'], name='idx_seseje_fecha'),
        ),
        migrations.AddIndex(
            model_name='sesionejecutivo',
            index=models.Index(fields=['portal'], name='idx_seseje_portal'),
        ),
    ]


=== ./operadores/migrations/0002_sesionactiva_token.py ===
# Generated by Django 5.1.7 on 2025-03-31 14:41

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('operadores', '0001_initial'),
    ]

    operations = [
        migrations.AddField(
            model_name='sesionactiva',
            name='token',
            field=models.CharField(blank=True, max_length=255, null=True),
        ),
    ]


=== ./operadores/migrations/0003_sesionactiva_cod_verificacion.py ===
# Generated by Django 5.1.7 on 2025-04-01 18:06

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('operadores', '0002_sesionactiva_token'),
    ]

    operations = [
        migrations.AddField(
            model_name='sesionactiva',
            name='cod_verificacion',
            field=models.CharField(blank=True, max_length=255, null=True),
        ),
    ]


=== ./operadores/migrations/0004_delete_sesionejecutivo.py ===
# Generated by Django 5.1.7 on 2025-04-04 18:11

from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ('operadores', '0003_sesionactiva_cod_verificacion'),
    ]

    operations = [
        migrations.DeleteModel(
            name='SesionEjecutivo',
        ),
    ]


=== ./operadores/views.py ===
# ./operadores/views.py
from rest_framework import viewsets, status
from rest_framework.decorators import action
from rest_framework.response import Response

from .models import (
    Operador, OperadorBodega, OperadorEmpresaModulo,
    OperadorEmpresaModuloMenu, OperadorGrupo, OperadorPuntoVenta,
    Sesion, SesionActiva
    # Nota: Se ha eliminado el uso de SesionEjecutivo
)
from .serializer import (
    OperadorSerializer, OperadorBodegaSerializer, OperadorEmpresaModuloSerializer,
    OperadorEmpresaModuloMenuSerializer, OperadorGrupoSerializer, OperadorPuntoVentaSerializer,
    SesionSerializer, SesionActivaSerializer
)

import jwt
from django.conf import settings
from datetime import datetime, timedelta
from django.utils import timezone
import secrets  # Para generar hashes aleatorios (cod_verificacion)
import requests  # Para enviar el correo replicando la lógica del cURL en PHP
import crypt    # Módulo para verificar el password con BlowFish

from django.db import connection
from django.http import HttpResponseForbidden


class RestrictToReactMixin:
    ALLOWED_ORIGIN = "http://localhost:5173"  # Cambia por el dominio real de tu aplicación React

    def initial(self, request, *args, **kwargs):
        origin = request.META.get("HTTP_ORIGIN")
        if origin != self.ALLOWED_ORIGIN:
            return HttpResponseForbidden("Acceso denegado.")
        return super().initial(request, *args, **kwargs)


def enviar_correo_python(remitente, correo_destino, asunto, detalle):
    """
    Función que replica la lógica del PHP para enviar correo.
    Realiza un POST a http://mail.smartgest.cl/mailserver/server_mail.php
    con los parámetros requeridos.
    """
    data = {
        "destino": correo_destino,
        "asunto": asunto,
        "detalle": detalle,
        "from": remitente
    }
    try:
        resp = requests.post("http://mail.smartgest.cl/mailserver/server_mail.php", data=data)
        # Opcional: se puede revisar resp.status_code, etc.
    except Exception as e:
        print(f"Error al enviar el correo: {e}")


class OperadorViewSet(RestrictToReactMixin, viewsets.ModelViewSet):
    queryset = Operador.objects.all()
    serializer_class = OperadorSerializer

    @action(detail=False, methods=['post'])
    def validar(self, request):
        """
        POST /operadores/operadores/validar/
        Valida que 'operador_id' y 'password' existan en la tabla 'operador'.
        Para la validación se obtiene el operador mediante 'operador_id' y se compara el hash
        almacenado en el campo 'password' con el valor enviado en la solicitud mediante
        crypt.crypt(provided_password, stored_hash) == stored_hash.
        
        Además se verifica lo siguiente:
          - El usuario debe encontrarse activo.
          - La empresa asociada al usuario debe estar activa.
          - El número de conexiones fallidas debe ser menor o igual a 2.
          
        Si alguna de estas condiciones no se cumple, se retorna el error correspondiente.
        Si la validación es correcta:
         - Se reinicia el contador de conexiones fallidas.
         - Se crea una sesión y se genera un token JWT.
         - Se genera y envía un código de verificación por correo.
         - Se retorna un código 200 con el "operador_id".
        """
        operador_id = request.data.get('operador_id')
        password_input = request.data.get('password')
        if not operador_id or not password_input:
            return Response(
                {"error": "Se requieren 'operador_id' y 'password'"},
                status=status.HTTP_400_BAD_REQUEST
            )

        # Verificar si existe un operador con ese ID y si la cuenta está bloqueada.
        try:
            op_temp = Operador.objects.get(operador_id=operador_id)
            if op_temp.conexion_fallida > 3:
                return Response(
                    {"error": "Cuenta bloqueada por demasiados intentos fallidos."},
                    status=status.HTTP_403_FORBIDDEN
                )
        except Operador.DoesNotExist:
            pass

        try:
            op = Operador.objects.get(operador_id=operador_id)
            # Validación de estado del usuario, estado de la empresa y conexiones fallidas
            if op.estado != 1:
                return Response(
                    {"error": "El usuario no se encuentra activo."},
                    status=status.HTTP_403_FORBIDDEN
                )
            if op.empresa.estado != 1:
                return Response(
                    {"error": "La empresa asociada al usuario no se encuentra activa."},
                    status=status.HTTP_403_FORBIDDEN
                )
            if op.conexion_fallida > 2:
                return Response(
                    {"error": "El usuario ha superado los intentos de conexión fallidos permitidos (3). Su cuenta ha sido bloqueada."},
                    status=status.HTTP_403_FORBIDDEN
                )
            # Verificar que la contraseña ingresada, al ser encriptada con el mismo salt del password almacenado,
            # coincida con el hash almacenado.
            if crypt.crypt(password_input, op.password) == op.password:
                # Si el login es exitoso, reiniciamos el contador de conexiones fallidas.
                if op.conexion_fallida > 0:
                    op.conexion_fallida = 0
                    op.save()

                response_data = {"operador_id": op.operador_id}

                payload = {
                    'id': op.id,
                    'operador_id': op.operador_id,
                    'exp': datetime.utcnow() + timedelta(hours=24)
                }
                token_jwt = jwt.encode(payload, settings.SECRET_KEY, algorithm='HS256')

                ip_address = request.META.get('REMOTE_ADDR', '') or request.META.get('HTTP_X_FORWARDED_FOR', '')
                if ',' in ip_address:
                    ip_address = ip_address.split(',')[0].strip()

                nueva_sesion = Sesion.objects.create(
                    ip=ip_address,
                    fecha=timezone.now(),
                    operador_id=op.operador_id,
                    empresa=op.empresa
                )

                random_hash = secrets.token_hex(16)
                SesionActiva.objects.create(
                    operador_id=op.operador_id,
                    sesion_id=str(nueva_sesion.id),
                    fecha_registro=timezone.now(),
                    empresa=op.empresa,
                    token=token_jwt,
                    cod_verificacion=random_hash
                )

                asunto = "Código de Verificación"
                detalle_mail = f"Hola, tu código de verificación es: {random_hash}"
                enviar_correo_python("DM", op.operador_id, asunto, detalle_mail)

                return Response(response_data, status=status.HTTP_200_OK)
            else:
                # Si la contraseña es incorrecta, se incrementa conexion_fallida en 1.
                try:
                    op_incorrecto = Operador.objects.get(operador_id=operador_id)
                    op_incorrecto.conexion_fallida += 1
                    op_incorrecto.save()
                except Operador.DoesNotExist:
                    pass
                return Response(
                    {"error": "No existe un operador con esos datos"},
                    status=status.HTTP_404_NOT_FOUND
                )
        except Operador.DoesNotExist:
            return Response(
                {"error": "No existe un operador con esos datos"},
                status=status.HTTP_404_NOT_FOUND
            )

    @action(detail=False, methods=['post'])
    def verificar(self, request):
        """
        POST /operadores/operadores/verificar/
        Recibe 'operador_id' y 'cod_verificacion'. Se debe mantener únicamente la
        sesión activa más reciente para ese operador.
        Si el 'cod_verificacion' coincide con la de la sesión más reciente:
         - Se eliminan todas las demás sesiones activas.
         - Se verifica además si el usuario tiene permiso para acceder a la funcionalidad
           'agregar_empresa' a través de la siguiente query:
           
         SELECT d.*
         FROM dm_sistema.operador_empresa_modulos_menu a
         JOIN dm_sistema.operador b ON a.operador_id = b.id
         JOIN dm_sistema.empresa_modulos_menu c ON a.empresa_modulo_menu_id = c.id
         JOIN dm_sistema.menus d ON c.menu_id = d.id
         JOIN dm_sistema.empresa_modulos e ON c.empresa_modulo_id = e.id
         WHERE b.id = %s
           AND d.url = 'agregar_empresa'
           AND e.estado = 1
           AND e.empresa_id = %s;
           
         - Se retorna el resultado de esa verificación junto con la información de la sesión, el operador y los módulos.
         - Se envía una cookie con el token de la sesión.
         - Se retorna un código 200 con los datos del operador, incluyendo "modulos" y el permiso para agregar empresa.
        """
        operador_id = request.data.get('operador_id')
        cod_verificacion = request.data.get('cod_verificacion')
        if not operador_id or not cod_verificacion:
            return Response(
                {"error": "Se requieren 'operador_id' y 'cod_verificacion'"},
                status=status.HTTP_400_BAD_REQUEST
            )

        sesiones = SesionActiva.objects.filter(
            operador_id=operador_id
        ).order_by('-fecha_registro')

        if not sesiones.exists():
            return Response(
                {"error": "No se encontró ninguna sesión activa para este operador."},
                status=status.HTTP_404_NOT_FOUND
            )

        sesion_reciente = sesiones.first()

        if sesion_reciente.cod_verificacion != cod_verificacion:
            return Response(
                {"error": "El código de verificación no coincide con la sesión activa más reciente."},
                status=status.HTTP_400_BAD_REQUEST
            )

        token_jwt = sesion_reciente.token

        # Eliminar todas las demás sesiones activas excepto la más reciente.
        SesionActiva.objects.filter(operador_id=operador_id).exclude(id=sesion_reciente.id).delete()

        try:
            op = Operador.objects.get(operador_id=operador_id)
        except Operador.DoesNotExist:
            return Response(
                {"error": "No se encontró el operador."},
                status=status.HTTP_404_NOT_FOUND
            )

        operator_data = {
            "operador_id": op.operador_id,
            "rut": op.rut,
            "nombres": op.nombres,
            "apellido_paterno": op.apellido_paterno,
            "apellido_materno": op.apellido_materno,
            "modificable": op.modificable,
            "email": op.email,
            "estado": op.estado,
            "acceso_web": op.acceso_web,
            "operador_administrador": op.operador_administrador,
            "grupo": op.grupo.id if op.grupo else None,
            "empresa": op.empresa.id if op.empresa else None,
            "superadmin": op.superadmin,
            "fecha_creacion": op.fecha_creacion
        }

        # Verificar que la empresa asociada al operador siga activa.
        if op.empresa.estado != 1:
            sesion_reciente.delete()
            return Response(
                {"error": "La empresa asociada al usuario se encuentra desactivada. La sesión ha sido cerrada."},
                status=status.HTTP_403_FORBIDDEN
            )

        # Obtener los módulos disponibles para el operador.
        modulos = []
        with connection.cursor() as cursor:
            cursor.execute("""
                SELECT c.nombre_menu, b.id, c.icon
                FROM dm_sistema.operador_empresa_modulos AS a
                JOIN dm_sistema.empresa_modulos AS b ON a.empresa_modulo_id = b.id
                JOIN dm_sistema.modulos AS c ON b.modulo_id = c.id
                WHERE a.operador_id = %s
                  AND b.estado = 1
                  AND c.estado = 1
                  AND b.empresa_id = %s
                ORDER BY c.orden
            """, [op.id, op.empresa.id])
            rows = cursor.fetchall()
            for row in rows:
                modulos.append({
                    "nombre_menu": row[0],
                    "id": row[1],
                    "icon": row[2]
                })

        # Verificar permiso para la funcionalidad 'agregar_empresa' usando la query proporcionada.
        permitir_agregar_empresa = False
        with connection.cursor() as cursor:
            cursor.execute("""
                SELECT d.*
                FROM dm_sistema.operador_empresa_modulos_menu a
                JOIN dm_sistema.operador b ON a.operador_id = b.id
                JOIN dm_sistema.empresa_modulos_menu c ON a.empresa_modulo_menu_id = c.id
                JOIN dm_sistema.menus d ON c.menu_id = d.id
                JOIN dm_sistema.empresa_modulos e ON c.empresa_modulo_id = e.id
                WHERE b.id = %s
                  AND d.url = %s
                  AND e.estado = 1
                  AND e.empresa_id = %s
            """, [op.id, 'agregar_empresa', op.empresa.id])
            result_func = cursor.fetchone()
            if result_func is not None:
                permitir_agregar_empresa = True

        response_data = {
            "message": "Verificación exitosa.",
            "operador": operator_data,
            "modulos": modulos,
            "permitir_agregar_empresa": permitir_agregar_empresa
        }
        response = Response(response_data, status=status.HTTP_200_OK)
        response.set_cookie(
            key='token',
            value=token_jwt,
            httponly=True,
            secure=True,
            max_age=24 * 3600,
            samesite='None'
        )
        return response

    @action(detail=False, methods=['get'])
    def logout(self, request):
        """
        GET /operadores/logout/
        Elimina la sesión activa correspondiente al token de la cookie 'token'.
        """
        token_cookie = request.COOKIES.get('token')
        if not token_cookie:
            return Response(
                {"error": "No se encontró la cookie 'token' en la solicitud."},
                status=status.HTTP_401_UNAUTHORIZED
            )

        try:
            sesion_activa = SesionActiva.objects.get(token=token_cookie)
        except SesionActiva.DoesNotExist:
            return Response(
                {"error": "El token de la cookie no coincide con ninguna sesión activa."},
                status=status.HTTP_404_NOT_FOUND
            )

        sesion_activa.delete()
        response = Response({"message": "Sesión eliminada correctamente."}, status=status.HTTP_200_OK)
        response.delete_cookie('token')
        return response


class OperadorBodegaViewSet(RestrictToReactMixin, viewsets.ModelViewSet):
    queryset = OperadorBodega.objects.all()
    serializer_class = OperadorBodegaSerializer


class OperadorEmpresaModuloViewSet(RestrictToReactMixin, viewsets.ModelViewSet):
    queryset = OperadorEmpresaModulo.objects.all()
    serializer_class = OperadorEmpresaModuloSerializer


class OperadorEmpresaModuloMenuViewSet(RestrictToReactMixin, viewsets.ModelViewSet):
    queryset = OperadorEmpresaModuloMenu.objects.all()
    serializer_class = OperadorEmpresaModuloMenuSerializer


class OperadorGrupoViewSet(RestrictToReactMixin, viewsets.ModelViewSet):
    queryset = OperadorGrupo.objects.all()
    serializer_class = OperadorGrupoSerializer


class OperadorPuntoVentaViewSet(RestrictToReactMixin, viewsets.ModelViewSet):
    queryset = OperadorPuntoVenta.objects.all()
    serializer_class = OperadorPuntoVentaSerializer


class SesionViewSet(RestrictToReactMixin, viewsets.ModelViewSet):
    queryset = Sesion.objects.all()
    serializer_class = SesionSerializer


class SesionActivaViewSet(RestrictToReactMixin, viewsets.ModelViewSet):
    queryset = SesionActiva.objects.all()
    serializer_class = SesionActivaSerializer


class OperadorByTokenViewSet(RestrictToReactMixin, viewsets.ViewSet):
    """
    GET /operadores/sesiones-activas-token/
    Obtiene la sesión activa leyendo la cookie 'token'.
    """
    def get_by_cookie(self, request):
        token_cookie = request.COOKIES.get('token')
        if not token_cookie:
            return Response({"error": "No se encontró la cookie 'token' en la solicitud."},
                            status=status.HTTP_401_UNAUTHORIZED)
        try:
            sesion_activa = SesionActiva.objects.get(token=token_cookie)
        except SesionActiva.DoesNotExist:
            return Response({"error": "El token en la cookie no coincide con ninguna sesión activa."},
                            status=status.HTTP_404_NOT_FOUND)

        sesion_activa_data = SesionActivaSerializer(sesion_activa).data

        try:
            op = Operador.objects.get(operador_id=sesion_activa.operador_id)
        except Operador.DoesNotExist:
            return Response(
                {"error": "No se encontró el operador relacionado a esta sesión activa."},
                status=status.HTTP_404_NOT_FOUND
            )

        operador_data = OperadorSerializer(op).data

        # Verificar si la empresa asociada al operador sigue activa.
        if op.empresa.estado != 1:
            sesion_activa.delete()
            return Response({"error": "La empresa asociada al usuario se encuentra desactivada. La sesión ha sido cerrada."},
                            status=status.HTTP_403_FORBIDDEN)

        modulos = []
        with connection.cursor() as cursor:
            cursor.execute("""
                SELECT c.nombre_menu, b.id, c.icon
                FROM dm_sistema.operador_empresa_modulos AS a
                JOIN dm_sistema.empresa_modulos AS b ON a.empresa_modulo_id = b.id
                JOIN dm_sistema.modulos AS c ON b.modulo_id = c.id
                WHERE a.operador_id = %s
                  AND b.estado = 1
                  AND c.estado = 1
                  AND b.empresa_id = %s
                ORDER BY c.orden
            """, [operador_data['id'], operador_data['empresa']])
            rows = cursor.fetchall()
            for row in rows:
                modulos.append({
                    "nombre_menu": row[0],
                    "id": row[1],
                    "icon": row[2]
                })

        combined_data = {
            "sesion_activa": sesion_activa_data,
            "operador_data": operador_data,
            "modulos": modulos
        }
        return Response(combined_data, status=status.HTTP_200_OK)


=== ./operadores/models.py ===
from django.db import models
from django.utils import timezone
from coreempresas.models import Grupo, Empresa
from configuracion.models import EmpresaModulo, EmpresaModuloMenu

class Operador(models.Model):
    operador_id = models.CharField(max_length=50)
    password = models.CharField(max_length=80, default='')
    clear = models.CharField(max_length=80, null=True, blank=True)
    rut = models.CharField(max_length=15, null=True, blank=True)
    nombres = models.CharField(max_length=100, null=True, blank=True)
    apellido_paterno = models.CharField(max_length=100, null=True, blank=True)
    apellido_materno = models.CharField(max_length=100, null=True, blank=True)
    modificable = models.IntegerField(default=1)
    email = models.CharField(max_length=50, null=True, blank=True)
    estado = models.IntegerField(default=1)
    acceso_web = models.IntegerField(default=0)
    conexion_fallida = models.IntegerField(default=0)
    operador_administrador = models.CharField(max_length=50, default='0')
    grupo = models.ForeignKey(
        Grupo,
        on_delete=models.CASCADE,
        null=True,
        blank=True,
        related_name='operadores'
    )
    empresa = models.ForeignKey(
        Empresa,
        on_delete=models.CASCADE,
        related_name='operadores'
    )
    superadmin = models.IntegerField(default=0)
    fecha_creacion = models.DateTimeField(default=timezone.now)

    class Meta:
        db_table = '"dm_sistema"."operador"'
        unique_together = (('operador_id', 'empresa'),)
        indexes = [
            models.Index(fields=['empresa'], name='idx_opr_emp_id'),
            models.Index(fields=['grupo'], name='idx_opr_grp_id'),
        ]

    def __str__(self):
        return self.operador_id


class OperadorBodega(models.Model):
    operador = models.ForeignKey(
        Operador,
        on_delete=models.CASCADE,
        related_name='bodegas'
    )
    bodega_id = models.IntegerField()
    empresa = models.ForeignKey(
        Empresa,
        on_delete=models.CASCADE,
        related_name='operador_bodegas'
    )

    class Meta:
        db_table = '"dm_sistema"."operador_bodega"'
        indexes = [
            models.Index(fields=['bodega_id'], name='idx_opbdg_bdg_id'),
            models.Index(fields=['empresa'], name='idx_opbdg_emp_id'),
        ]

    def __str__(self):
        return f'{self.operador} - Bodega {self.bodega_id}'


class OperadorEmpresaModulo(models.Model):
    operador = models.ForeignKey(
        Operador,
        on_delete=models.CASCADE,
        related_name='empresa_modulos'
    )
    empresa_modulo = models.ForeignKey(
        EmpresaModulo,
        on_delete=models.CASCADE,
        null=True,
        blank=True
    )

    class Meta:
        db_table = '"dm_sistema"."operador_empresa_modulos"'
        indexes = [
            models.Index(fields=['operador'], name='idx_oem_opr_id'),
            models.Index(fields=['empresa_modulo'], name='idx_oem_em_id'),
        ]

    def __str__(self):
        return f'{self.operador} - {self.empresa_modulo}'


class OperadorEmpresaModuloMenu(models.Model):
    operador = models.ForeignKey(
        Operador,
        on_delete=models.CASCADE,
        related_name='empresa_modulos_menus'
    )
    empresa_modulo_menu = models.ForeignKey(
        EmpresaModuloMenu,
        on_delete=models.CASCADE,
        null=True,
        blank=True
    )

    class Meta:
        db_table = '"dm_sistema"."operador_empresa_modulos_menu"'
        indexes = [
            models.Index(fields=['operador'], name='idx_oemm_opr_id'),
            models.Index(fields=['empresa_modulo_menu'], name='idx_oemm_mm_id'),
        ]

    def __str__(self):
        return f'{self.operador} - {self.empresa_modulo_menu}'


class OperadorGrupo(models.Model):
    operador = models.ForeignKey(
        Operador,
        on_delete=models.CASCADE,
        related_name='grupos_operador'
    )
    grupo = models.ForeignKey(
        Grupo,
        on_delete=models.CASCADE,
        related_name='operadores_grupo'
    )

    class Meta:
        db_table = '"dm_sistema"."operador_grupos"'
        unique_together = (('operador', 'grupo'),)

    def __str__(self):
        return f'{self.operador} - {self.grupo}'


class OperadorPuntoVenta(models.Model):
    operador = models.ForeignKey(
        Operador,
        on_delete=models.CASCADE,
        related_name='puntos_venta'
    )
    punto_venta_id = models.IntegerField()
    empresa = models.ForeignKey(
        Empresa,
        on_delete=models.CASCADE,
        related_name='operador_punto_ventas'
    )

    class Meta:
        db_table = '"dm_sistema"."operador_punto_venta"'
        indexes = [
            models.Index(fields=['empresa'], name='idx_opv_emp_id'),
        ]

    def __str__(self):
        return f'{self.operador} - Punto de Venta {self.punto_venta_id}'


class Sesion(models.Model):
    ip = models.CharField(max_length=20)
    fecha = models.DateTimeField()
    operador_id = models.CharField(max_length=50)
    empresa = models.ForeignKey(
        Empresa,
        on_delete=models.CASCADE,
        null=True,
        blank=True
    )

    class Meta:
        db_table = '"dm_sistema"."sesiones"'

    def __str__(self):
        return f'Sesion {self.id} - {self.operador_id}'


class SesionActiva(models.Model):
    empresa = models.ForeignKey(
        Empresa,
        on_delete=models.CASCADE,
        null=True,
        blank=True
    )
    operador_id = models.CharField(
        max_length=50,
        null=True,
        blank=True
    )
    sesion_id = models.CharField(
        max_length=255,
        null=True,
        blank=True
    )
    fecha_registro = models.DateTimeField(default=timezone.now)

    token = models.CharField(
        max_length=255,
        null=True,
        blank=True
    )
    cod_verificacion = models.CharField(
        max_length=255,
        null=True,
        blank=True
    )

    class Meta:
        db_table = '"dm_sistema"."sesiones_activas"'
        indexes = [
            models.Index(fields=['sesion_id'], name='idx_sact_sid'),
            models.Index(fields=['empresa'], name='idx_sact_emp_id'),
        ]

    def __str__(self):
        return f'Sesion Activa {self.id}'


=== ./operadores/tests.py ===
from django.test import TestCase

# Create your tests here.


=== ./operadores/apps.py ===
from django.apps import AppConfig


class OperadoresConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'operadores'


=== ./db.sqlite3 ===
SQLite format 3   @     q   !           ;                                                 q .WJ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       d!Bw4VP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0 %Atasks0001_initial2025-03-21 15:17:55.8928523 %Asessions0001_initial2025-03-21 12:20:32.061523H WAauth0012_alter_user_first_name_max_length2025-03-21 12:20:32.047144@ GAauth0011_update_proxy_permissions2025-03-21 12:20:32.032979C MAauth0010_alter_group_name_max_length2025-03-21 12:20:32.021626G UAauth0009_alter_user_last_name_max_length2025-03-21 12:20:32.006876F SAauth0008_alter_user_username_max_length2025-03-21 12:20:31.992576K ]Aauth0007_alter_validators_add_error_messages2025-03-21 12:20:31.976503A IAauth0006_require_contenttypes_00022025-03-21 12:20:31.964805B
 KAauth0005_alter_user_last_login_null2025-03-21 12:20:31.958763@	 GAauth0004_alter_user_username_opts2025-03-21 12:20:31.941603C MAauth0003_alter_user_email_max_length2025-03-21 12:20:31.926604H WAauth0002_alter_permission_name_max_length2025-03-21 12:20:31.910364H %GAcontenttypes0002_remove_content_type_name2025-03-21 12:20:31.894284I WAadmin0003_logentry_add_action_flag_choices2025-03-21 12:20:31.869946A GAadmin0002_logentry_remove_auto_add2025-03-21 12:20:31.8566780 %Aadmin0001_initial2025-03-21 12:20:31.833738/ %Aauth0001_initial2025-03-21 12:20:31.8139077 %%Acontenttypes0001_initial2025-03-21 12:20:31.787239 ``v                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          -django_admin_log+auth_permission	!auth_group
	auth_user   !tasks_task&3django_content_type                    /django_migrations
   | |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      taskstasksessionssession%#contenttypescontenttypeauthuserauthgroup!authpermission	adminlogentry    b:rN.T#`D"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    'view_taskCan view task  #+delete_taskCan delete task  #+change_taskCan change task %add_taskCan add task" %-view_sessionCan view session& )1delete_sessionCan delete session& )1change_sessionCan change session  #+add_sessionCan add session+ -7view_contenttypeCan view content type/ 1;delete_contenttypeCan delete content type/ 1;change_contenttypeCan change content type) +5add_contenttypeCan add content type 'view_userCan view user  #+delete_userCan delete user  #+change_userCan change user %add_userCan add user !)view_groupCan view group" %-delete_groupCan delete group"
 %-change_groupCan change group	 'add_groupCan add group( +3view_permissionCan view permission, /7delete_permissionCan delete permission, /7change_permissionCan change permission& )1add_permissionCan add permission$ 	'1view_logentryCan view log entry( 	+5delete_logentryCan delete log entry( 	+5change_logentryCan change log entry" 	%/add_logentryCan add log entry
    mWG4!n\G2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            view_task#delete_task#change_taskadd_task%view_session)delete_session)change_session#add_session-view_contenttype1delete_contenttype1change_contenttype+add_contenttypeview_user#delete_user#change_useradd_user!view_group%delete_group%change_group
add_group	+view_permission/delete_permission/change_permission)add_permission	'view_logentry	+delete_logentry	+change_logentry	%	add_logentry   G G                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             6 =A	=		Apbkdf2_sha256$870000$Y3fsG76r2PHHauJnWXkGW5$OECMM0PesNWwskOyEkAe5x5EtU4cLC03MnNkA6/wgZw=2025-03-21 15:04:12.868342adminignrvsmartgest@gmail.com2025-03-21 14:22:17.007757
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 	admin                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          #MUAgcgzg3m5m0eaqcn0g24lxodg8ypsf2a0.eJxVjMsOwiAQRf-FtSFMoTxcuvcbyDAMUjU0Ke3K-O_apAvd3nPOfYmI21rj1nmJUxZnAeL0uyWkB7cd5Du22yxpbusyJbkr8qBdXufMz8vh_h1U7PVbKwBjAwGoMqAzMCgmQyNTSp7JZu1YMSNaV5z3oK22Jejsw2iYC5N4fwDZ8Dg4:1tvduu:nXVL2yWhQdmlEj7d8UfYQc2ntPLxxD5sw2AKuwK-BOU2025-04-04 15:04:12.874553#MUAhs96bag6ik3x5asmj66hgxsyi68ahltg.eJxVjMsOwiAQRf-FtSFMoTxcuvcbyDAMUjU0Ke3K-O_apAvd3nPOfYmI21rj1nmJUxZnAeL0uyWkB7cd5Du22yxpbusyJbkr8qBdXufMz8vh_h1U7PVbKwBjAwGoMqAzMCgmQyNTSp7JZu1YMSNaV5z3oK22Jejsw2iYC5N4fwDZ8Dg4:1tvdGV:R0kiaVV54kigyib8HsUNe6jtRpqDBtBT7uS-_Z27CVo2025-04-04 14:22:27.230914
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               $Mgcgzg3m5m0eaqcn0g24lxodg8ypsf2a0#M	hs96bag6ik3x5asmj66hgxsyi68ahltg                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
   ] {uoic]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
						                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 $	wWO  =                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ?k-sindexauth_user_groups_user_id_group_id_94350c0c_uniqauth_user_groupsCREATE UNIQUE INDEX "auth_user_groups_user_id_group_id_94350c0c_uniq" ON "auth_user_groups" ("user_id", "group_id"):g9aindexauth_group_permissions_permission_id_84c5c92eauth_group_permissionsCREATE INDEX "auth_group_permissions_permission_id_84c5c92e" ON "auth_group_permissions" ("permission_id")+]9Mindexauth_group_permissions_group_id_b120cbf9auth_group_permissionsCREATE INDEX "auth_group_permissions_group_id_b120cbf9" ON "auth_group_permissions" ("group_id")0--tableauth_user_groupsauth_user_groupsCREATE TABLE "auth_user_groups" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "user_id" integer NOT NULL REFERENCES "auth_user" ("id") DEFERRABLE INITIALLY DEFERRED, "group_id" integer NOT NULL REFERENCES "auth_group" ("id") DEFERRABLE INITIALLY DEFERRED)&                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            N997tableauth_group_permissionsauth_group_permissions	CREATE TABLE "auth_group_permissions" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "group_id" integer NOT NULL REFERENCES "auth_group" ("id") DEFERRABLE INITIALLY DEFERRED, "permission_id" integer NOT NULL REFERENCES "auth_permission" ("id") DEFERRABLE INITIALLY DEFERRED)                                                                                                                                                                                                                O-1indexauth_user_groups_user_id_6a12ed8bauth_user_groupsCREATE INDEX "auth_user_groups_user_id_6a12ed8b" ON "auth_user_groups" ("user_id")j9#indexauth_group_permissions_group_id_permission_id_0cd325b0_uniqauth_group_permissionsCREATE UNIQUE INDEX "auth_group_permissions_group_id_permission_id_0cd325b0_uniq" ON "auth_group_permissions" ("group_id", "permission_id")XAA;tableauth_user_user_permissionsauth_user_user_permissionsCREATE TABLE "auth_user_user_permissions" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "user_id" integer NOT NULL REFERENCES "auth_user" ("id") DEFERRABLE INITIALLY DEFERRED, "permission_id" integer NOT NULL REFERENCES "auth_permission" ("id") DEFERRABLE INITIALLY DEFERRED)P++Ytablesqlite_sequencesqlite_sequenceCREATE TABLE sqlite_sequence(name,seq)Y//atabledjango_migrationsdjango_migrationsCREATE TABLE "django_migrations" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "app" varchar(255) NOT NULL, "name" varchar(255) NOT NULL, "applied" datetime NOT NULL)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  q jp

<	m7 q                                                                 C2!!Qtabletasks_tasktasks_task!CREATE TABLE "tasks_task" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "title" varchar(200) NOT NULL, "description" text NOT NULL, "completed" bool NOT NULL)1S)9indexdjango_session_expire_date_a5c62663django_session CREATE INDEX "django_session_expire_date_a5c62663" ON "django_session" ("expire_date")6/))'tabledjango_sessiondjango_session
CREATE TABLE "django_session" ("session_key" varchar(40) NOT NULL PRIMARY KEY, "session_data" text NOT NULL, "expire_date" datetime NOT NULL);0O) indexsqlite_autoindex_django_session_1django_session1.E indexsqlite_autoindex_auth_user_1auth_user+!!mtableauth_groupauth_groupCREATE TABLE "auth_group" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "name" varchar(150) NOT NULL UNIQUE)3,G! indexsqlite_autoindex_auth_group_1auth_group*-#tableauth_userauth_userCREATE TABLE "auth_user" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "password" varchar(128) NOT NULL, "last_login" datetime NULL, "is_superuser" bool NOT NULL, "username" varchar(150) NOT NULL UNIQUE, "last_name" varchar(150) NOT NULL, "email" varchar(254) NOT NULL, "is_staff" bool NOT NULL, "is_active" bool NOT NULL, "date_joined" datetime NOT NULL, "first_name" varchar(150) NOT NULL)$"]+Mindexauth_permission_content_type_id_2f476e4bauth_permissionCREATE INDEX "auth_permission_content_type_id_2f476e4b" ON "auth_permission" ("content_type_id")S!y+indexauth_permission_content_type_id_codename_01ab375a_uniqauth_permissionCREATE UNIQUE INDEX "auth_permission_content_type_id_codename_01ab375a_uniq" ON "auth_permission" ("content_type_id", "codename")% ++tableauth_permissionauth_permissionCREATE TABLE "auth_permission" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "content_type_id" integer NOT NULL REFERENCES "django_content_type" ("id") DEFERRABLE INITIALLY DEFERRED, "codename" varchar(100) NOT NULL, "name" varchar(255) NOT NULL)Ho3{indexdjango_content_type_app_label_model_76bd3d3b_uniqdjango_content_typeCREATE UNIQUE INDEX "django_content_type_app_label_model_76bd3d3b_uniq" ON "django_content_type" ("app_label", "model")I339tabledjango_content_typedjango_content_typeCREATE TABLE "django_content_type" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "app_label" varchar(100) NOT NULL, "model" varchar(100) NOT NULL)O-1indexdjango_admin_log_user_id_c564eba6django_admin_logCREATE INDEX "django_admin_log_user_id_c564eba6" ON "django_admin_log" ("user_id")(_-Qindexdjango_admin_log_content_type_id_c4bce8ebdjango_admin_logCREATE INDEX "django_admin_log_content_type_id_c4bce8eb" ON "django_admin_log" ("content_type_id")~--/tabledjango_admin_logdjango_admin_logCREATE TABLE "django_admin_log" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "object_id" text NULL, "object_repr" varchar(200) NOT NULL, "action_flag" smallint unsigned NOT NULL CHECK ("action_flag" >= 0), "change_message" text NOT NULL, "content_type_id" integer NULL REFERENCES "django_content_type" ("id") DEFERRABLE INITIALLY DEFERRED, "user_id" integer NOT NULL REFERENCES "auth_user" ("id") DEFERRABLE INITIALLY DEFERRED, "action_time" datetime NOT NULL)JoAqindexauth_user_user_permissions_permission_id_1fbb5f2cauth_user_user_permissionsCREATE INDEX "auth_user_user_permissions_permission_id_1fbb5f2c" ON "auth_user_user_permissions" ("permission_id")8cAYindexauth_user_user_permissions_user_id_a95ead1bauth_user_user_permissionsCREATE INDEX "auth_user_user_permissions_user_id_a95ead1b" ON "auth_user_user_permissions" ("user_id")w	A/indexauth_user_user_permissions_user_id_permission_id_14a6b632_uniqauth_user_user_permissionsCREATE UNIQUE INDEX "auth_user_user_permissions_user_id_permission_id_14a6b632_uniq" ON "auth_user_user_permissions" ("user_id", "permission_id")Q-5indexauth_user_groups_group_id_97559544auth_user_groupsCREATE INDEX "auth_user_groups_group_id_97559544" ON "auth_user_groups" ("group_id")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             	
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               			   { {                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      taskstask sessionssession %#contenttypescontenttype authuser authgroup !authpermission adminlogentry                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          =	 	+	A2Prueba #2[{"added": {}}]2025-03-21 15:21:47.958467=	 	+	A1Prueba #1[{"added": {}}]2025-03-21 15:21:21.106694
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           A2025-04-04 15:04:12.874553A	2025-04-04 14:22:27.230914 j jwn                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               h                                                                                                          $                                 $                                 $                                 $                                 $                                H                               &    & 	Test #6Prueba #6# 	Prueba #5Test #5&" +1Tarea de pruebaesta es una prueba  	Prueba #3Test 3                  ! Prueba #4Test #4

=== ./proyectoDesarrollo/urls.py ===
# ./proyectoDesarrollo/urls.py

from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('admin/', admin.site.urls),
    # Se incluye la app "operadores" (ya existente)
    path('operadores/', include('operadores.urls')),
    # Se incluye la app "coreempresas" con el prefijo "coreempresas/"
    path('coreempresas/', include('coreempresas.urls')),
    # Se incluyen las demás apps
    path('configuracion/', include('configuracion.urls')),
    path('tasks/', include('tasks.urls')),
]


=== ./proyectoDesarrollo/__init__.py ===


=== ./proyectoDesarrollo/asgi.py ===
"""
ASGI config for proyectoDesarrollo project.

It exposes the ASGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/5.1/howto/deployment/asgi/
"""

import os

from django.core.asgi import get_asgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'proyectoDesarrollo.settings')

application = get_asgi_application()


=== ./proyectoDesarrollo/wsgi.py ===
"""
WSGI config for proyectoDesarrollo project.

It exposes the WSGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/5.1/howto/deployment/wsgi/
"""

import os

from django.core.wsgi import get_wsgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'proyectoDesarrollo.settings')

application = get_wsgi_application()


=== ./proyectoDesarrollo/settings.py ===
"""
Django settings for proyectoDesarrollo project.

Generated by 'django-admin startproject' using Django 5.1.7.

For more information on this file, see
https://docs.djangoproject.com/en/5.1/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/5.1/ref/settings/
"""

from pathlib import Path
import os  # <-- ¡Importante agregar esta línea!

# Build paths inside the project like this: BASE_DIR / 'subdir'.
BASE_DIR = Path(__file__).resolve().parent.parent

# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/5.1/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = 'django-insecure-5bluxl5na1#wnt1576=xcs&#55w!p6l4#_-m1sjyfku2fa00v='

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = False  # Ponlo False en producción

ALLOWED_HOSTS = [
    'localhost',
    '127.0.0.1',
    '35.222.2.211',
    'desarrollo.smartgest.cl'
        # Ajusta con tu IP o dominio
]

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    # Terceros
    'rest_framework',
    'corsheaders',  # <-- Asegúrate de tenerlo instalado y aquí
    # Tus apps
    'coreempresas',
    'configuracion',
    'operadores',
    'tasks',
    'logs',
    #'inventario',
    #'catalogo',
    #'proveedores',
    #'solicitudes',
    #'servicios',
    #'compras',
    # etc...
]

MIDDLEWARE = [
    'corsheaders.middleware.CorsMiddleware',  # <-- Importante que vaya antes de CommonMiddleware
    'django.middleware.common.CommonMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

ROOT_URLCONF = 'proyectoDesarrollo.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [BASE_DIR / 'templates'],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]

WSGI_APPLICATION = 'proyectoDesarrollo.wsgi.application'

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'mi_basedatos',      
        'USER': 'mi_usuario',        
        'PASSWORD': 'mi_password',   
        'HOST': 'localhost',         
        'PORT': '5432',              
    }
}

LANGUAGE_CODE = 'es-cl'
TIME_ZONE = 'America/Santiago'
USE_I18N = True
USE_L10N = True
USE_TZ = True

# Static files (CSS, JavaScript, Images)
STATIC_URL = '/static/'
STATIC_ROOT = os.path.join(BASE_DIR, 'static')
MEDIA_URL = '/media/'
MEDIA_ROOT = os.path.join(BASE_DIR, 'media')

# ============================================
# CORS CONFIGURATION PARA INCLUIR CREDENCIALES
# ============================================
CORS_ALLOW_CREDENTIALS = True
CORS_ALLOWED_ORIGINS = [
    'http://localhost:5173',      
    'http://35.222.2.211:8000',
    'http://0.0.0.0:5173',    
    'http://0.0.0.0:8000',    
]
CSRF_TRUSTED_ORIGINS = [
    'http://localhost:5173',
    'http://35.222.2.211:8000',
    'http://0.0.0.0:5173',
    'http://0.0.0.0:8000',
]

REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': (
        'rest_framework.authentication.SessionAuthentication',
        'rest_framework.authentication.BasicAuthentication',
        # etc...
    ),
    'DEFAULT_PERMISSION_CLASSES': (
        'rest_framework.permissions.AllowAny',
    ),
}
